spec_version: 2
description: Deploy ADOC Application.
inputs:
  prefix:
    type: string
    default: debug2
    description: Resource prefix name
  my_ip:
    type: string
    default: 0.0.0.0/0
    description: This IP for Webapp access
  region:
    type: string
    default: ap-northeast-1
    description: Region of Webapp
  instance_type:
    type: string
    default: t2.micro
    description: Instance type
  agent:
    type: agent
    default: Quali

grains:
  adoc-db:
    kind: terraform
    spec:
      source:
        store: iac-assets
        path: terraform/web-3-tier/adoc-app
      agent:
        name: '{{ .inputs.agent }}'
      authentication:
      - adoc-aws-user
      inputs:
      - prefix: '{{ .inputs.prefix }}'
      - name: 'db'
      - instance_type: '{{ .inputs.instance_type }}'
      - region: '{{ .inputs.region }}'
      - security_group_ids: '[
          "sg-06aa1174f354ad316"
        ]'
      - subnet_id: 'subnet-0bb1f37d0294541dd'
      - shell_script_path: 'setup_db_sv.sh'
      - shell_script_variables: '{
          "elastic_agent_install": "true",
          "elastic_agent_token": "{{ .params.ELASTIC_AGENT_TOKEN }}"
        }'
      env-vars: []
      outputs:
      - private_ip
      - public_ip
    tf-version: 1.4.6
